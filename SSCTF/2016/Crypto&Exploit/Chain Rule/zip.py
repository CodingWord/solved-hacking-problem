import os
import pickle
from zipfile import ZipFile, BadZipfile

DIR = 'zip'

files = []
for filename in os.listdir(DIR):
    files.append(filename)

pw = 'start'

password_dict = {}
end = 0

while 1:
    if end:
        break
    for filename in files:
        zip_file = ZipFile(os.path.join(DIR, filename))
        try:
            txt = zip_file.open('1.txt', pwd=pw)
            content = txt.read()
            txt.close()
            password_dict[filename] = pw
            print '%s content - %s' % (filename, content)
            if b'the end' in content:
                end = 1
                break
            pw = content[len('Next password is '):]
        except (RuntimeError, BadZipfile):
            pass
        zip_file.close()

print '438981 password - %s' % password_dict['438981.zip']
print '357781 password - %s' % password_dict['357781.zip']

f = open('dict', 'w')
pickle.dump(password_dict, f)
f.close()

'''
438981 password - GjG$1rA{ev6V&9uM
357781 password - N3&eZ1S&4h0#Xx#0
'''
